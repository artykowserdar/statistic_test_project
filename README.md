# Statistic Test Project

Backend‚Äë–ø—Ä–æ–∫—Å–∏ + —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è API **bot.e-replika.ru**

–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–µ–º—É API –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –∑–∞–º–µ—Ç–∫–∏, `last_visited`) –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

---

## üìå –û –ø—Ä–æ–µ–∫—Ç–µ

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–ø—Ä–æ–∫—Å–∏‚Äë—Å–µ—Ä–≤–µ—Ä**, –∫–æ—Ç–æ—Ä—ã–π:

- –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `https://bot.e-replika.ru/api/v1/*`
- –ü–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ `Authorization: Bearer <token>` –≤–æ –≤–Ω–µ—à–Ω–∏–π API
- –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞:
  - `allah-names`
  - `duas`
  - `goals`
- –•—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:
  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ (`view_count`)
  - –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É –ø–æ—Å–µ—â–µ–Ω–∏—è (`last_visited_at`)
  - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ (`notes`)
- –û—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/stats/...`

‚ö† **–í–∞–∂–Ω–æ:** –≤—Å–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—É—â–Ω–æ—Å—Ç–µ–π ‚Äî `UUID`, –∞ –Ω–µ `int`. –ü–∞—Ä–∞–º–µ—Ç—Ä `content_id` –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞.

---

## üß∞ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Backend:** FastAPI (Python 3.9+)
- **Database:** PostgreSQL
- **ORM:** SQLAlchemy 2.0 (async)
- **HTTP Client:** httpx (async)
- **Config:** pydantic‚Äësettings + `.env`
- **Logging:** logging + uvicorn
- **Server:** uvicorn (—á–µ—Ä–µ–∑ `run.py`)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
statistic_test_project/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI + lifespan
‚îÇ   ‚îú‚îÄ‚îÄ config.py             # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py           # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models.py             # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py            # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ proxy_service.py      # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ stats_service.py      # –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ routers/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ proxy.py          # –ü—Ä–æ–∫—Å–∏ –∫ –≤–Ω–µ—à–Ω–µ–º—É API
‚îÇ       ‚îî‚îÄ‚îÄ stats.py          # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∑–∞–º–µ—Ç–æ–∫
‚îú‚îÄ‚îÄ alembic/                  # –ú–∏–≥—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ run.py                    # –£–¥–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å)
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <—Ç–≤–æ–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd statistic_test_project
```

### 2. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

–ü—Ä–∏–º–µ—Ä `.env`:

```env
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/statistic_test_db
EXTERNAL_API_BASE=https://bot.e-replika.ru/api/v1
APP_PORT=8080
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
createdb statistic_test_db
```

(–∏–ª–∏ —á–µ—Ä–µ–∑ `psql` / `pgAdmin`)

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
python run.py
```

Production‚Äë—Ä–µ–∂–∏–º:

```bash
python run.py --prod
```

Swagger UI –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

üëâ **http://localhost:8080/docs**

---

## üîå –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω –ê–ª–ª–∞—Ö–∞

```bash
curl -H "Authorization: Bearer test_token_123" \
     http://localhost:8080/api/v1/allah-names/
```

### –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏–º—è (–∏ –∑–∞–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É)

```bash
curl -H "Authorization: Bearer test_token_123" \
     http://localhost:8080/api/v1/allah-names/aea461e5-58a9-43e7-9d6d-893a635d979a
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É

```bash
curl -H "Authorization: Bearer test_token_123" \
     http://localhost:8080/api/stats/content/allah_name/aea461e5-58a9-43e7-9d6d-893a635d979a
```

### –î–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É

```bash
curl -X PATCH \
     -H "Authorization: Bearer test_token_123" \
     -H "Content-Type: application/json" \
     -d '{"notes": "–û—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤–æ–µ –∏–º—è, –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å 100 —Ä–∞–∑"}' \
     http://localhost:8080/api/stats/content/allah_name/aea461e5-58a9-43e7-9d6d-893a635d979a
```

---

## üõ† –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (TODO)

- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ Alembic‚Äë–º–∏–≥—Ä–∞—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å JWT‚Äë–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
  - —Ç–æ–ø –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
  - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  - —á–∞—Å—ã –∏–∑—É—á–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis / Memcached)
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å rate‚Äëlimit –≤–Ω–µ—à–Ω–µ–≥–æ API
- –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã (pytest + httpx)

---

## üë§ –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–∞–∫ **—Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ**  
–§–µ–≤—Ä–∞–ª—å 2026

